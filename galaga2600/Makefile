# simple makefile for assembling an Atari VCS game using dasm
#     and for testing the game with Stella

PROJ_NAME = galaga2600
# define the NTSC and PAL 'main' sources
NTSC_MAIN = galagaNTSC.asm
PAL_MAIN  = galagaPAL.asm

# define the NTSC and PAL binary names
# should be located in the 'bin' directory
NTSC_BIN = galagaNTSC.bin
PAL_BIN  = galagaPAL.bin

# list file names generated by dasm
# located in the 'bin' directory
NTSC_LST = galagaNTSC.lst
PAL_LST  = galagaPAL.lst

# symbol dumps generated by dasm
# located in the 'bin' directory
NTSC_SYM = galagaNTSC.sym
PAL_SYM  = galagaPAL.sym

# build targets
all: build-ntsc build-pal

.PHONY: clean
# delete the binaries that get built
clean:
	rm ./bin/$(NTSC_BIN) ./bin/$(NTSC_LST) ./bin/$(NTSC_SYM) ./bin/$(PAL_BIN) ./bin/$(PAL_LST) ./bin/$(PAL_SYM) && rmdir ./bin

# make the build directory
make-bin-dir:
	mkdir ./bin

# build the binaries
build-ntsc: make-bin-dir
	dasm $(NTSC_MAIN) -f3 -v5 -l./bin/$(NTSC_LST) -s./bin/$(NTSC_SYM) -o./bin/$(NTSC_BIN)

build-pal:
	dasm $(PAL_MAIN) -f3 -v5 -l./bin/$(PAL_LST) -s./bin/$(PAL_SYM) -o./bin/$(PAL_BIN)

# all of the 'run' commands are phony targets, so they don't build
#   the binaries again
.PHONY: run-ntsc run-pal run-secam

# run with stella while showing the TIA stats
run: run-ntsc

run-ntsc:
	stella -stats 1 -format NTSC ./bin/$(NTSC_BIN)

run-pal:
	stella -stats 1 -format PAL ./bin/$(PAL_BIN)

run-secam:
	stella -stats 1 -format SECAM ./bin/$(PAL_BIN)

.PHONY: backup
# tar and gzip the files
backup:
	cd .. && \
	tar -cvzf ./$(PROJ_NAME)_`date +%m-%d-%Y_%H-%M-%S`.tar.gz $(PROJ_NAME)
